# Interactive Map Demo

A comprehensive Flutter application showcasing advanced interactive map implementations with multiple use cases including cruise destinations, ship deck plans, route-based itinerary maps, cruise catalog system, countdown widgets, and digital stateroom keys.

> **‚ö†Ô∏è AI-Generated**: This project was primarily generated using AI tools (Cursor with Claude Sonnet 4 and GPT-5). Please proceed with caution and thoroughly review all code before using in production environments.

## üìã Table of Contents

- [Features](#features)
  - [Interactive Destination Map (Great Stirrup Cay)](#Ô∏è-interactive-destination-map-great-stirrup-cay)
  - [Cruise Itinerary Map (Multiple Routes)](#Ô∏è-cruise-itinerary-map-multiple-routes---backend-driven)
  - [Cruise Catalog Map](#Ô∏è-cruise-catalog-map)
  - [Cruise Countdown Widget](#Ô∏è-cruise-countdown-widget)
  - [Multi-Deck Ship Map (Norwegian Aqua)](#Ô∏è-multi-deck-ship-map-norwegian-aqua)
  - [Digital Stateroom Key](#Ô∏è-digital-stateroom-key)
- [Technical Details](#technical-details)
  - [Dual Map Architecture: Image-Based vs Geographic Coordinates](#dual-map-architecture-image-based-vs-geographic-coordinates)
  - [Backend Integration & Data Flow](#backend-integration--data-flow)
  - [Offline Vector Tiles & Performance Engineering](#offline-vector-tiles--performance-engineering)
  - [iOS Home Widget System](#ios-home-widget-system)
  - [Digital Key & BLE Integration](#digital-key--ble-integration)
- [Project Structure](#project-structure)
- [Licensing & Attribution](#Ô∏è-licensing--attribution)
- [AI Digest](#ai-digest)

## ‚ú® Features

### üèùÔ∏è Interactive Destination Map (Great Stirrup Cay)

**Great Stirrup Cay with POI markers and filtering**

<img src="assets/gifs/great-stirrup-cay.gif" width="45%" alt="Great Stirrup Cay Demo">

- **POI Markers**: Category-based filtering with responsive zoom tiers
- **Interactive Gestures**: Pan, zoom, double-tap, long-press reset
- **Smooth Animations**: Selected markers with pulsing glow effects
- **Detail Views**: Bottom sheet dialogs with marker information
- **Widget Composition**: Small, focused, reusable widgets

### üó∫Ô∏è Cruise Itinerary Map (Multiple Routes) - **Backend-Driven**

**Backend-driven Caribbean & Transatlantic routes with automatic day positioning and path generation**

<p align="center">
  <img src="assets/gifs/caribbean-cruise.gif" width="45%" alt="7-Day Caribbean Cruise - Image-Based Navigation">
  <img src="assets/gifs/7-day-caribbean-cruise-flutter-map.gif" width="45%" alt="7-Day Caribbean Cruise - FlutterMap Navigation">
</p>

<p align="center">
  <img src="assets/gifs/transatlantic-cruise.gif" width="45%" alt="15-Day Transatlantic Cruise - Image-Based Navigation">
  <img src="assets/gifs/15-day-transatlantic-cruise-flutter-map.gif" width="45%" alt="15-Day Transatlantic Cruise - FlutterMap Navigation">
</p>

- **Multi-Itinerary Support**: Caribbean (7-day) and Transatlantic (15-night) cruise routes
- **Backend-Driven Positioning**: All map elements positioned using backend-provided coordinate data
- **Dynamic Route Generation**: Routes automatically generated from backend itinerary data
- **Day-by-Day Navigation**: Swipeable cards with auto-centering day indicators
- **Bidirectional Route Animation**: Smooth forward/backward animations between days
- **Smart Layout Management**: Automatic padding prevents bottom sheet from covering map content
- **Performance Optimization**: Cached image sizes, efficient marker rendering, ScrollController management

### üåç Cruise Catalog Map

**Interactive world map with NCL cruise routes, search, and filtering**

<p align="center">
  <img src="assets/gifs/cruise-catalog.gif" width="45%" alt="Cruise Catalog Demo">
  <img src="assets/gifs/cruise-catalog-search.gif" width="45%" alt="Cruise Catalog Search Demo">
</p>

- **Interactive World Map**: FlutterMap-based world view with NCL cruise routes
- **Dynamic Zoom Tiers**: Cruises appear/disappear based on zoom level (essential, medium, detailed)
- **Smart Cruise Selection**: Click routes to select cruises with automatic map fitting
- **Port Cycling**: Tap port markers to cycle through all cruises visiting that port
- **Advanced Search System**: Full-text search across cruise titles, ships, destinations, and ports
- **Category Filtering**: Filter cruises by region (Caribbean, Mediterranean, Europe, etc.)
- **Draggable Sheet Interface**: Collapsible bottom sheet with mode-specific content
- **Sheet Mode System**: Normal browsing, search mode, and cruise details modes
- **Spain & Portugal Cruises**: Comprehensive collection of realistic NCL itineraries

### ‚è∞ Cruise Countdown Widget

**iOS home screen widget with countdown timers**

<img src="assets/gifs/home-widget.gif" width="45%" alt="Countdown Widget Demo">

- **iOS Home Screen Widget**: Native iOS widget displaying selected cruise countdown
- **Method Channel Communication**: `home_widget` package enables seamless app-to-widget data sharing
- **Interactive Countdown Timer**: Real-time countdown showing days, hours, minutes, and seconds
- **Cruise Selection**: Choose from multiple upcoming cruises to track
- **Visual Indicators**: Color-coded alerts for cruises departing soon
- **Auto-refresh**: Widget updates every hour automatically
- **App Groups Integration**: Secure data sharing between app and widget extension

### üö¢ Multi-Deck Ship Map (Norwegian Aqua)

**Norwegian Aqua deck plans with interactive polygon areas**

<img src="assets/gifs/ncl-aqua-deck-plan.gif" width="45%" alt="Deck Plan Demo">

> **‚ö†Ô∏è Work in Progress**: This is a quick preview of what's possible with interactive ship deck plans. Mapping polygon/path lines to the deck plan image isn't fully implemented yet. The current demo shows the foundational architecture and UI components.

- **Multi-Deck Navigation**: Browse 16 decks (Decks 5-20) with mini-map
- **Interactive Polygons**: Clickable areas for ship facilities
- **Legend System**: Swipeable bottom sheet with facility categories
- **Multi-Ship Support**: Extensible architecture for different ship classes

### üîë Digital Stateroom Key

**BLE-based mobile access system for stateroom doors**

- **BLE-Based Access**: Bluetooth Low Energy communication with stateroom locks
- **ASSA ABLOY Mobile Access SDK**: Secure credential provisioning and validation
- **Bluetooth Low Energy**: Offline stateroom unlocking without internet connection
- **Dart Frog Backend**: Lightweight server for credential management
- **Device-bound Credentials**: Time-limited, secure storage with on-device encryption
- **On-Demand Provisioning**: Keys provisioned when guest requests access in-app

## üîß Technical Details

### Dual Map Architecture: Image-Based vs Geographic Coordinates

The project implements **two distinct interactive map types**, each optimized for different use cases and offering unique capabilities:

#### **1. Image-Based Coordinate Maps** üñºÔ∏è

**Coordinate System**: `[x, y]` pixel coordinates relative to background map images

```dart
// Backend provides itinerary with image path and pixel coordinates
CruiseItinerary(
  name: '7-Day Caribbean Cruise',
  imagePath: 'https://api.cruisecompany.com/maps/caribbean_cruise_map.png',
  days: [
    ItineraryDay(
      dayNumber: 1,
      port: PortData(
        name: 'Miami',
        coordinates: [100, 50], // x=100px, y=50px on map image
      ),
    ),
  ],
);

// App automatically positions everything using pixel coordinates
final position = _getDayPosition(dayIndex); // ‚Üí Offset(100, 50)
// ‚úÖ Marker appears at exact pixel position
// ‚úÖ Route paths follow pixel coordinates
// ‚úÖ Tap detection uses pixel-based hit testing
// ‚ö†Ô∏è Requires online image loading from imagePath
```

| ‚úÖ **Pros**                                                               | ‚ùå **Cons**                                                                     |
| ------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| **üéØ Pixel-Perfect Precision**: Exact positioning on custom map images    | **üñºÔ∏è Static Assets**: Requires custom map images for each region/route          |
| **üöÄ Backend-Driven**: APIs provide coordinates, app displays immediately | **üìè Limited Scale**: Fixed resolution, no zoom-based detail levels             |
| **üì± Device Independent**: Works consistently across all screen sizes     | **üåç Geographic Inaccuracy**: No real-world distance/position relationships     |
| **‚ö° Zero Configuration**: No manual positioning or calibration needed    | **üîó No External Integration**: Cannot integrate with standard mapping services |
| **üîÑ Dynamic Updates**: Change backend data, map updates automatically    | **üìä Limited Data Sources**: Cannot use standard GIS data or APIs               |
| **üé® Custom Visuals**: Full control over map appearance and branding      | **üîç No Geocoding**: Cannot perform address lookup or reverse geocoding         |
| **üíæ Lightweight**: Simple image loading, minimal dependencies            | **üó∫Ô∏è No Standard Features**: Missing zoom, pan, geographic bounds               |

#### **2. Geographic Coordinate Maps** üåç

**Coordinate System**: `[latitude, longitude]` real-world geographic coordinates

```dart
// Geographic coordinates for real-world locations
final miamiLocation = LatLng(25.7617, -80.1918);
final caribbeanPorts = [
  LatLng(18.4655, -66.1057), // San Juan
  LatLng(17.1899, -88.4976), // Belize City
  LatLng(19.4326, -99.1332), // Mexico City
];

FlutterMap(
  options: MapOptions(
    initialCenter: miamiLocation,
    initialZoom: 6.0,
  ),
  children: [
    CustomMapTileLayers(mapConfig: config),
    MarkerLayer(
      markers: caribbeanPorts.map((latLng) =>
        Marker(point: latLng, builder: (ctx) => PortMarker())
      ).toList(),
    ),
  ],
);
```

| ‚úÖ **Pros**                                                                   | ‚ùå **Cons**                                                              |
| ----------------------------------------------------------------------------- | ------------------------------------------------------------------------ |
| **üåê Real-World Accuracy**: True geographic positioning and distances         | **üìä Data Complexity**: Requires geographic coordinate management        |
| **üó∫Ô∏è Standard Map Features**: Zoom, pan, geographic bounds, clustering        | **üîß Configuration Overhead**: Requires map tile setup and configuration |
| **üìä Data Integration**: Works with standard GIS data and APIs                | **üíæ Larger Bundle Size**: Map tiles and styles increase app size        |
| **üîç Search & Geocoding**: Standard address lookup and reverse geocoding      | **üåç Coordinate Management**: Requires lat/lng coordinate system         |
| **üì± Native Map Apps**: Integration with device's native mapping capabilities | **‚ö° Performance Considerations**: Tile loading and rendering overhead   |
| **üåç Global Coverage**: Access to worldwide geographic data                   | **üé® Limited Customization**: Bound by standard map styling options      |
| **üéØ Industry Standard**: Follows established mapping conventions             | **üì± Device Variations**: May behave differently across devices          |
| **üîÑ Scalable**: Works for any geographic region without custom assets        |                                                                          |

#### **Detailed Comparison Tables**

| **Feature**                | **Image-Based Maps**            | **Geographic Maps**               | **Winner**     |
| -------------------------- | ------------------------------- | --------------------------------- | -------------- |
| **Geographic Accuracy**    | ‚ùå Pixel coordinates only       | ‚úÖ Real-world lat/lng             | üåç Geographic  |
| **Custom Branding**        | ‚úÖ Full control                 | ‚ö†Ô∏è Limited by tile styles         | üñºÔ∏è Image-Based |
| **Global Coverage**        | ‚ùå Requires custom images       | ‚úÖ Worldwide data included        | üåç Geographic  |
| **Standard Features**      | ‚ùå Custom implementation needed | ‚úÖ Built-in zoom, pan, clustering | üåç Geographic  |
| **Data Integration**       | ‚ùå Custom coordinate system     | ‚úÖ Standard GIS data sources      | üåç Geographic  |
| **Search & Geocoding**     | ‚ùå Not available                | ‚úÖ Built-in capabilities          | üåç Geographic  |
| **Native Map Integration** | ‚ùå No integration               | ‚úÖ Seamless integration           | üåç Geographic  |
| **Bundle Size**            | ‚úÖ Lightweight (images only)    | ‚ö†Ô∏è Larger (tiles + styles)        | üñºÔ∏è Image-Based |
| **Setup Complexity**       | ‚úÖ Simple image loading         | ‚ö†Ô∏è Requires configuration         | üñºÔ∏è Image-Based |
| **Scalability**            | ‚ùå New images for each region   | ‚úÖ Works everywhere               | üåç Geographic  |
| **Performance**            | ‚úÖ Fast image rendering         | ‚ö†Ô∏è Tile loading overhead          | üñºÔ∏è Image-Based |
| **Future-Proofing**        | ‚ùå Custom maintenance required  | ‚úÖ Industry standard              | üåç Geographic  |

#### **üèÜ Recommendation: Geographic FlutterMap Implementation**

**This approach provides the foundation for a professional, scalable cruise application that meets industry standards and user expectations. For production cruise applications, we strongly recommend the **Geographic FlutterMap approach** for the following reasons:**

##### **üéØ Key Advantages & Benefits**

- **üîÑ Scalable**: Single implementation works for all cruise routes worldwide without custom assets
- **üì± Offline Capability**: Full functionality without internet connection using local vector tiles
- **üìä Rich Data**: Access to comprehensive port, weather, maritime, and local attraction data
- **üéØ User Expectations**: Matches user experience from other travel apps and mapping platforms
- **üîß Maintainable**: Industry-standard tools, libraries, and development practices available
- **üìà Future-Proof**: Easily extensible for new features, regions, and emerging technologies
- **üì± Native Integration**: Works with device GPS, navigation apps, location services, and native map applications
- **üîç Search Capabilities**: Enables port search, distance calculations, route planning, and geocoding
- **üìä Data Integration**: Seamlessly integrates with existing cruise booking, navigation, and port management systems

##### **üí° Best Use Cases for Each Approach**

| **Use Case**                | **Recommended Approach** | **Reasoning**                                           |
| --------------------------- | ------------------------ | ------------------------------------------------------- |
| **Cruise Itinerary Maps**   | üåç Geographic FlutterMap | Real-world accuracy, global coverage, industry standard |
| **Cruise Catalog/Booking**  | üåç Geographic FlutterMap | Search integration, port information, route planning    |
| **Custom Destination Maps** | üñºÔ∏è Image-Based           | Branded resort/island maps with custom POIs             |
| **Ship Deck Plans**         | üñºÔ∏è Image-Based           | Architectural layouts, facility locations               |
| **Interactive Port Guides** | üåç Geographic FlutterMap | Real-world navigation, local attractions                |
| **Cruise Route Planning**   | üåç Geographic FlutterMap | Distance calculations, weather integration              |

### Backend Integration & Data Flow

The system supports **both coordinate types** for backend integration:

```mermaid
flowchart TD
    subgraph "Backend Data"
        A[API Response] --> B{Coordinate Type?}
        B -->|Pixel + Image Path| C[Image-Based Data]
        B -->|Lat/Lng Only| D[Geographic Data]
    end

    subgraph "Data Processing"
        C --> E[Pixel Coordinates + Image Asset]
        D --> F[Geographic Coordinates]
        E --> G[Image-Based Maps]
        F --> H[Geographic Maps]
    end

    subgraph "Map Rendering"
        G --> I[Custom Image Rendering<br/>+ Image Loading + Asset Management]
        H --> J[FlutterMap Rendering<br/>+ Offline Tiles + Standard Features]
        I --> K[Interactive Experience]
        J --> K
    end

    K --> L[User Interaction]
    L --> M[Dynamic Updates]
```

### Offline Vector Tiles & Performance Engineering

**FlutterMap Geographic Mapping Excellence**: Our **offline vector tile system** demonstrates the power and flexibility of FlutterMap-based geographic mapping, offering unparalleled customization while maintaining exceptional performance.

**Massive Data Optimization**: Transformed a 75GB world map into a 50MB cruise-focused database through strategic zoom level pruning and geographic targeting.

#### **Data Optimization & Performance**

- **99.93% Size Reduction**: 75GB world map ‚Üí 50MB cruise-optimized database
- **Strategic Zoom Targeting**: Levels 3-6 cover 100% of cruise routes and destinations
- **Zero Network Dependency**: Perfect offline functionality with instant loading
- **Offline Reliability**: 100% uptime without network dependency
- **Cost Effective**: No data charges or roaming fees for map usage
- **Privacy Enhanced**: No location data sent to external servers

#### **FlutterMap Customization & Capabilities**

- **Complete Visual Control**: Customize colors, fonts, icons, and styling
- **Geographic Targeting**: Include only relevant regions and exclude unnecessary areas
- **Brand Integration**: Match your app's design language and branding perfectly
- **Performance Tuning**: Optimize tile loading, caching, and rendering for your use case
- **Flexible Configuration**: Adjust map behavior, interactions, and features as needed
- **Vector Tile Caching**: Pre-loaded tiles for instant rendering
- **GPU Acceleration**: 60fps smooth pan/zoom performance
- **Memory Management**: Intelligent tile eviction and reloading
- **Cruise Ship Ready**: Perfect for maritime environments with limited connectivity
- **Custom Tile Provider**: Specialized tile providers for different data sources

## üìÅ Project Structure

```
assets/
‚îú‚îÄ‚îÄ gifs/                               # Demo GIFs for README
‚îÇ   ‚îú‚îÄ‚îÄ great-stirrup-cay.gif           # Interactive destination map demo (31MB)
‚îÇ   ‚îú‚îÄ‚îÄ caribbean-cruise.gif            # 7-day Caribbean cruise demo (8MB)
‚îÇ   ‚îú‚îÄ‚îÄ transatlantic-cruise.gif        # 15-day Transatlantic cruise demo (6.4MB)
‚îÇ   ‚îú‚îÄ‚îÄ 7-day-caribbean-cruise-flutter-map.gif # FlutterMap Caribbean demo (6.1MB)
‚îÇ   ‚îú‚îÄ‚îÄ 15-day-transatlantic-cruise-flutter-map.gif # FlutterMap Transatlantic demo (10MB)
‚îÇ   ‚îú‚îÄ‚îÄ ncl-aqua-deck-plan.gif          # Norwegian Aqua deck plan demo (13MB)
‚îÇ   ‚îú‚îÄ‚îÄ cruise-catalog.gif              # Cruise catalog demo (56MB)
‚îÇ   ‚îú‚îÄ‚îÄ cruise-catalog-search.gif       # Cruise catalog search demo (7.6MB)
‚îÇ   ‚îî‚îÄ‚îÄ home-widget.gif                 # iOS home widget demo (18MB)
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ map.jpg                         # Great Stirrup Cay map (1.8MB)
‚îÇ   ‚îú‚îÄ‚îÄ caribbean_cruise_map.png        # Caribbean route map (20KB)
‚îÇ   ‚îú‚îÄ‚îÄ norwegian_pearl_transatlantic_map.png  # Transatlantic route map (20KB)
‚îÇ   ‚îú‚îÄ‚îÄ cruise-ship.svg                 # Cruise ship icon
‚îÇ   ‚îî‚îÄ‚îÄ deck-8.svg                      # Ship deck plan
‚îú‚îÄ‚îÄ styles/                             # Vector tile styles and fonts
‚îÇ   ‚îú‚îÄ‚îÄ style.json                      # MapTiler-based vector style
‚îÇ   ‚îú‚îÄ‚îÄ fonts/                          # Font files for vector tiles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Noto Sans Bold/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Noto Sans Regular/
‚îÇ   ‚îî‚îÄ‚îÄ sprites/                        # Sprite files for vector tiles
‚îî‚îÄ‚îÄ tiles/                              # Offline vector tiles
    ‚îî‚îÄ‚îÄ planet_map.mbtiles              # MBTiles vector tile database

lib/
‚îú‚îÄ‚îÄ common/                             # Shared utilities and configurations
‚îÇ   ‚îú‚îÄ‚îÄ map_config.dart                 # Unified map configuration system
‚îÇ   ‚îú‚îÄ‚îÄ map_utilities.dart              # Map utility functions
‚îÇ   ‚îú‚îÄ‚îÄ mbtiles/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mbtiles_vector_tile_provider.dart # MBTiles vector tile provider
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ custom_draggable_sheet.dart
‚îÇ       ‚îú‚îÄ‚îÄ custom_map_tile_layers.dart
‚îÇ       ‚îú‚îÄ‚îÄ custom_marker.dart
‚îÇ       ‚îú‚îÄ‚îÄ custom_polyline_layer.dart
‚îÇ       ‚îî‚îÄ‚îÄ custom_sticky_header_delegate.dart
‚îú‚îÄ‚îÄ countdown_widget/                   # iOS home screen widget
‚îÇ   ‚îú‚îÄ‚îÄ countdown_modal.dart           # Bottom sheet modal for cruise selection
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cruise_countdown.dart      # Cruise countdown data model
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îî‚îÄ‚îÄ simple_countdown_widget.dart # Countdown timer widget
‚îú‚îÄ‚îÄ cruise_catalog/                     # Cruise catalog system
‚îÇ   ‚îú‚îÄ‚îÄ cruise_catalog.dart            # Main cruise catalog widget
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ncl_cruise_catalog.dart    # NCL cruise catalog data
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cruise_category.dart       # Cruise region categories
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cruise_product.dart        # Cruise product model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cruise_route.dart          # Cruise route and waypoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sheet_mode.dart            # Sheet mode and position enums
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ cruise_details_mode_header.dart
‚îÇ       ‚îú‚îÄ‚îÄ cruise_details_mode_sheet.dart  # Cruise details content
‚îÇ       ‚îú‚îÄ‚îÄ cruise_itinerary_preview.dart
‚îÇ       ‚îú‚îÄ‚îÄ cruise_route_overlay.dart  # Route rendering on map
‚îÇ       ‚îú‚îÄ‚îÄ normal_mode_header.dart
‚îÇ       ‚îú‚îÄ‚îÄ normal_mode_sheet.dart     # Normal browsing content
‚îÇ       ‚îú‚îÄ‚îÄ search_mode_header.dart
‚îÇ       ‚îî‚îÄ‚îÄ search_mode_sheet.dart     # Search results content
‚îú‚îÄ‚îÄ deck_plan/                          # Ship deck plan maps
‚îÇ   ‚îú‚îÄ‚îÄ multi_deck_ship_map.dart       # Core deck map widget
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deck_polygon_data.dart
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ship_deck_data.dart
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ deck_key_legend.dart
‚îÇ       ‚îú‚îÄ‚îÄ deck_mini_map.dart
‚îÇ       ‚îî‚îÄ‚îÄ deck_polygon_overlay.dart
‚îú‚îÄ‚îÄ digital_key/                        # Digital stateroom key system
‚îÇ   ‚îú‚îÄ‚îÄ digital_key_page.dart          # Main digital key interface
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stateroom_access_data.dart # Stateroom access data model
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îî‚îÄ‚îÄ stateroom_access_page.dart # Stateroom access widget
‚îú‚îÄ‚îÄ interactive_map/                    # Great Stirrup Cay destination map
‚îÇ   ‚îú‚îÄ‚îÄ interactive_map.dart           # Main interactive map widget
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interactive_map_marker_data.dart
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ marker_details_page.dart
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ interactive_map_error.dart
‚îÇ       ‚îú‚îÄ‚îÄ interactive_map_filter.dart
‚îÇ       ‚îú‚îÄ‚îÄ interactive_map_legend.dart
‚îÇ       ‚îú‚îÄ‚îÄ interactive_map_marker.dart
‚îÇ       ‚îî‚îÄ‚îÄ interactive_map_marker_detail.dart
‚îú‚îÄ‚îÄ itinerary/                          # Cruise itinerary and route maps
‚îÇ   ‚îú‚îÄ‚îÄ data/                           # Sample itinerary data files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ caribbean_cruise.dart       # Norwegian Aqua 7-day Caribbean cruise
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transatlantic_cruise.dart   # Norwegian Pearl 15-night Transatlantic cruise
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cruise_itinerary.dart       # Core models (CruiseItinerary, PortData, ItineraryDay)
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cruise_itinerary_page.dart
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ cruise_route_painter.dart   # Custom route visualization painter
‚îÇ       ‚îú‚îÄ‚îÄ info_tile.dart
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_bottom_section.dart  # Draggable bottom sheet with auto-scrolling day indicators
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_map.dart          # Main route map widget
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_table.dart
‚îÇ       ‚îú‚îÄ‚îÄ port_day_info.dart
‚îÇ       ‚îú‚îÄ‚îÄ port_marker.dart            # Extracted marker widget with complex styling
‚îÇ       ‚îî‚îÄ‚îÄ sea_day_info.dart
‚îú‚îÄ‚îÄ itinerary_map/                      # Enhanced itinerary map system
‚îÇ   ‚îú‚îÄ‚îÄ data/                           # Enhanced itinerary data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ caribbean_cruise.dart       # Caribbean cruise data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transatlantic_cruise.dart   # Transatlantic cruise data
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ world_samples.dart          # Global cruise samples (Alaska, Mediterranean, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ itinerary_map.dart             # Main itinerary map widget
‚îÇ   ‚îú‚îÄ‚îÄ itinerary_map_controller.dart  # Map controller for interactions
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cruise_itinerary.dart       # Enhanced cruise itinerary models
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ info_widgets/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ info_tile.dart
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ port_day_info.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ sea_day_info.dart
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_map_bottom_sheet.dart
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_map_markers.dart
‚îÇ       ‚îú‚îÄ‚îÄ itinerary_map_polylines.dart
‚îÇ       ‚îî‚îÄ‚îÄ itinerary_map_tile_layers.dart
‚îî‚îÄ‚îÄ main.dart                           # App entry point and navigation
```

## ‚öñÔ∏è Licensing & Attribution

This project uses **fully offline mapping** with local vector tiles and styles. Review the following licensing requirements before shipping commercially:

### **Style License: OSM Liberty (BSD License)**

- **Style**: `assets/styles/style.json` uses **OSM Liberty** style (not MapTiler Basic)
- **License**: BSD License (derived from Mapbox Open Styles)
- **Usage**: ‚úÖ **FREE** for commercial use with attribution
- **Requirements**: Must retain copyright notice and attribution

### **Data Source: OpenMapTiles (CC-BY 4.0)**

- **Data**: `assets/tiles/planet_map.mbtiles` contains OpenMapTiles vector data
- **License**: Creative Commons Attribution 4.0 (CC-BY 4.0)
- **Usage**: ‚úÖ **FREE** for commercial use with attribution
- **Requirements**: Must credit OpenMapTiles and OpenStreetMap contributors

### **Required Attribution (MANDATORY)**

You **MUST** display the following attribution on all map screens:

```
¬© OpenMapTiles (https://openmaptiles.org/)
¬© OpenStreetMap contributors (https://www.openstreetmap.org/copyright)
```

### **Implementation Required**

Add an attribution overlay to your FlutterMap widgets:

```dart
FlutterMap(
  // ... your existing map configuration
  children: [
    // ... your existing layers
    AttributionWidget.defaultWidget(
      source: '¬© OpenMapTiles (https://openmaptiles.org/) ¬© OpenStreetMap contributors (https://www.openstreetmap.org/copyright)',
      onSourceTapped: () {},
    ),
  ],
)
```

## ü§ñ AI Digest

### Quick Project Understanding

**Purpose**: Flutter demo showcasing six interactive map implementations, with **primary focus on backend-driven itinerary maps** that automatically generate from API data, plus **cruise catalog system**, **iOS home widgets**, and **digital stateroom keys**.

**Key Innovation**: **Backend-Driven Map System**

- Backend provides daily itinerary locations as `[x, y]` pixel coordinates
- App automatically positions markers, draws route paths, enables navigation
- Zero hardcoding - all positioning is data-driven and updates dynamically

**Key Components**:

- `InteractiveMap`: POI-based map with markers and filtering
- `MultiDeckShipMap`: Deck plans with polygon interactions (work in progress)
- `ItineraryMap`: **Backend-driven** route map with automatic positioning
- `CruiseCatalogMap`: Interactive world map with NCL cruise routes and search
- `CountdownWidget`: iOS home screen widget with cruise countdown timers
- `DigitalKeyPage`: BLE-based stateroom access system

**Coordinate System**: Image-based `[x, y]` pixel coordinates designed for backend integration.

- Coordinates are pixel positions on map images (e.g., `[100, 50]`)
- Backend APIs provide coordinates, app displays immediately
- Single source of truth: `_getDayPosition(dayIndex)` controls all positioning

**Architecture**: Backend-driven positioning with unified coordinate system.

- All map elements (markers, routes, taps) use same position calculation
- `_generateRoutePositions()` creates paths from day coordinates
- Dynamic updates when backend data changes
- **Centralized Scroll Management**: Single CustomScrollView with unified controller
- **Content-Only Widgets**: Separated content from scroll management for better animations

**File Structure**: Eight main modules (`common/`, `countdown_widget/`, `cruise_catalog/`, `deck_plan/`, `digital_key/`, `interactive_map/`, `itinerary/`, `itinerary_map/`) with models, pages, and widgets subdirectories, organized alphabetically.

**Entry Point**: `main.dart` ‚Üí `Home` ‚Üí Individual feature implementations.

**Dependencies**: Flutter setup with `flutter_map`, `latlong2`, `flutter_map_animations`, `vector_map_tiles`, `mbtiles`, `home_widget`, `jovial_svg` for comprehensive feature support.

**Assets**: `assets/gifs/` (demo GIFs for README), `assets/images/` (maps, icons, deck plans), `assets/styles/` (vector tile styles and fonts), `assets/tiles/` (offline MBTiles database).

**Demo GIFs**: Visual demonstrations integrated within feature sections, available in `assets/gifs/`:

- `great-stirrup-cay.gif` (31MB) - Interactive destination map with POI filtering
- `caribbean-cruise.gif` (8MB) - 7-day Caribbean cruise route with day navigation
- `transatlantic-cruise.gif` (6.4MB) - 15-night transatlantic cruise with auto-scrolling indicators
- `7-day-caribbean-cruise-flutter-map.gif` (6.1MB) - FlutterMap Caribbean demo
- `15-day-transatlantic-cruise-flutter-map.gif` (10MB) - FlutterMap Transatlantic demo
- `ncl-aqua-deck-plan.gif` (13MB) - Multi-deck ship navigation with interactive polygons
- `cruise-catalog.gif` (56MB) - Cruise catalog system demo
- `cruise-catalog-search.gif` (7.6MB) - Cruise catalog search functionality
- `home-widget.gif` (18MB) - iOS home screen widget demonstration

**Performance**: Cached image sizes, efficient rendering, zoom-based visibility, minimal rebuilds, centralized scroll management.

**State**: Local `StatefulWidget` state, `TransformationController` for map interactions, `AnimationController` for transitions, sheet mode management, widget data persistence.

**Backend Integration & Animation**:

- JSON API provides itinerary days with embedded coordinates
- `CruiseItinerary.fromApi()` parses backend data
- Modular data architecture with separate files per cruise type (`CaribbeanCruiseData`, `TransatlanticCruiseData`)
- `_getDayPosition()` converts coordinates to screen positions
- `_generateRoutePositions()` creates curved route paths from day coordinates
- `CruiseRoutePainter` handles all route visualization and animations
- Auto-scrolling day indicators with smooth ScrollController animations
- Bidirectional route animations (forward fill, backward unfill)
- Automatic map generation with smooth navigation transitions
- **Advanced Layout Management**: Dual-viewport system with 250px natural padding prevents UI overlay conflicts
- **No White Space Guarantee**: Calculated minimum scale ensures map always fills entire viewport
- **Smart Boundary Logic**: Padded coordinate system maintains proper constraints and interactions
- **Cruise Catalog System**: Interactive world map with NCL routes, search, and filtering
- **Centralized Scroll Management**: Single CustomScrollView with unified controller for all sheet modes
- **Content-Only Architecture**: Separated content widgets from scroll management for better animations
- **Widget Integration**: iOS home screen widget with method channel communication
- **Digital Key System**: BLE-based stateroom access with ASSA ABLOY Mobile Access SDK
- **Offline Vector Tiles**: Local MBTiles support for offline map functionality
- **Fully Offline Implementation**: No external tile servers, all mapping data is local
- **Platform Focus**: iOS and Android only (removed web, desktop, and test platforms)
